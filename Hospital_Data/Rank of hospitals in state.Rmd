---
title: "Ranking hospitals by outcome in a state"
author: "Macarena L. Fernandez Carro"
date: "2023-09-26"
output: html_document
---

```{r}

rankhospital <- function(state, outcome, rank = "best") {
  
  ### read the data
  
  data <- read.csv("outcome-of-care-measures.csv", colClasses = "character")
  fd <- as.data.frame(cbind(data[, 2],   # hospital
                            data[, 7],   # state
                            data[, 11],  # heart attack
                            data[, 17],  # heart failure
                            data[, 23]), # pneumonia
                      stringAsFactors = FALSE)
  colnames(fd) <- c("hospital", "state", "heart attack", "heart failure", "pneumonia")
  
  ### check validity of state and outcome
  
if (!state %in% fd[, "state"]) {
        stop('invalid state')
    } else if (!outcome %in% c("heart attack", "heart failure", "pneumonia")){
        stop('invalid outcome')
    } else if (is.numeric(rank)) {
        si <- which(fd[, "state"] == state)
        ts <- fd[si, ]                     # extracting dataframe for the called state
        ts[, eval(outcome)] <- as.numeric(ts[, eval(outcome)])
        ts <- ts[order(ts[, eval(outcome)], ts[, "hospital"]), ]
        output <- ts[, "hospital"][rank]
    } else if (!is.numeric(rank)){
        if (rank == "best") {
             output <- best(state, outcome)
        } else if (rank == "worst") {
                si <- which(fd[, "state"] == state)
                ts <- fd[si, ]    
                ts[, eval(outcome)] <- as.numeric(ts[, eval(outcome)])
                ts <- ts[order(ts[, eval(outcome)], ts[, "hospital"], decreasing = TRUE), ]
                output <- ts[, "hospital"][1]
        } else {
            stop('invalid rank')
        }
    }
return(output)
} 
  

### example output

rankhospital("NC","heart attack", "worst")
```